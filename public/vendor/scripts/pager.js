!function(a){var b=function(b,c){"use strict";var d=function(a,b){return function(){var d=arguments;return c.computed(function(){return a.apply(b,d)})}},e={};e.page=null,e.now=function(){return Date.now?Date.now():(new Date).valueOf()},e.extendWithPage=function(a){var b=new e.Page;a.$__page__=b,e.page=b,e.activePage$=d(e.getActivePage,e)()};var f=function(a,b,c){c=c||{},c.page=a,e[b].fire(c),a.val(b)&&a.val(b)(c)};b.each(["onBindingError","onSourceError","onNoMatch","onMatch","beforeRemove","afterRemove","beforeHide","afterHide","beforeShow","afterShow"],function(a,c){e[c]=b.Callbacks()}),e.showChild=function(a){var b=a&&1===a.length&&""===a[0]?[]:a;e.page.showPage(b)},e.getParentPage=function(a){for(;a;){if(a.$page&&"none"!==a.$page.val("urlToggle"))return a.$page;if(a.$data&&a.$data.$__page__)return a.$data.$__page__;a=a.$parentContext}return null};var g=null,h=null,i=function(a){h&&h.reject({cancel:!0}),g=null,a.substring(0,e.Href.hash.length)===e.Href.hash&&(a=a.slice(e.Href.hash.length));var b=j(a);e.showChild(b)};e.goTo=i,e.navigate=function(a){e.useHTML5history?e.Href5.history.pushState(null,null,a):location.hash=a};var j=function(a){return b.map(a.replace(/\+/g," ").split("/"),decodeURIComponent)},k={};k.value=c.utils.unwrapObservable,k.arrayValue=function(a){return b.map(a,function(a){return k.value(a)})};var l=function(a){for(var b,c={},d=/([^&=]+)=?([^&]*)/g;b=d.exec(a);)c[b[1]]=b[2];return c},m=function(a){if(!a)return{name:null,params:{}};var b=a.split("?"),c=b[0],d=b[1],e={};return d&&(e=l(d)),{name:c,params:e}};e.ChildManager=function(a,d){this.currentChildO=c.observable(null);var g=this;this.page=d,this.timeStamp=e.now(),this.hideChild=function(){var a=g.currentChildO();a&&(a.isStartPage()||(a.hidePage(function(){}),g.currentChildO(null)))},this.showChild=function(c){var d=0===c.length;this.timeStamp=e.now();var h=this.timeStamp,i=g.currentChildO(),j=null,l=!1,n=m(c[0]),o=n.name,p=null;b.each(a(),function(a,b){if(!l){var c=b.getId();(c===o||(""===o||null==o)&&b.isStartPage())&&(l=!0,j=b),"?"===c&&(p=b)}});for(var q=!1,r=g,s=function(a,b){if(!l){var c=b.getId(),d=b.getValue().modal;d&&((c===o||(""===o||null==o)&&b.isStartPage())&&(l=!0,j=b,q=!0),"?"!==c||p||(p=b,q=!0))}};!j&&r.page.parentPage&&!r.page.getValue().modal;){var t=r.page.parentPage.children;b.each(t(),s),j||(r=r.page.parentPage.childManager)}j||!p||d||(j=p),g.currentChildO(j),j&&(q?j.currentParentPage(g.page):j.currentParentPage(null));var u=function(){f(g.page,"onNoMatch",{route:c})},v=function(){f(g.page,"onMatch",{route:c});var a=k.value(j.getValue().guard);a?a(j,c,function(){g.timeStamp===h&&j.showPage(c.slice(1),n,c[0])},i):j.showPage(c.slice(1),n,c[0])};i&&i===j?v():i?i.hidePage(function(){j?v():u()}):j?v():u()}},e.Page=function(a,b,d,f,g){this.element=a,this.valueAccessor=b,this.allBindingsAccessor=d,this.viewModel=f,this.bindingContext=g,this.children=c.observableArray([]),this.childManager=new e.ChildManager(this.children,this),this.parentPage=null,this.currentId=null,this.getCurrentId=c.observable(),this.ctx=null,this.currentParentPage=c.observable(null),this.isVisible=c.observable(!1),this.originalRoute=c.observable(null),this.route=null};var n=e.Page.prototype;n.val=function(a){return k.value(this.getValue()[a])},n.currentChildPage=function(){return this.childManager.currentChildO},n.find=function(a){var c=k.value(a),d=this;if("/"===c.substring(0,1))d=e.page,c=c.slice(1);else for(;"../"===c.substring(0,3);)d=d.currentParentPage&&d.currentParentPage()?d.currentParentPage():d.parentPage,c=c.slice(3);var f=j(c);return b.each(f,function(a,b){d=d.child(b)()}),d},n.find$=function(a){return d(this.find,this)(a)},n.path=function(a){var c=this,d=k.value(a);if(d&&"object"==typeof d&&d.path&&d.params&&!(d instanceof e.Page)){var f=d.path,g=d.params;return c.path(f)+"?"+b.param(g)}var h;if(null==d||""===d)h=c;else{if(!(d instanceof e.Page)){if("/"===d.substring(0,1))return e.page.getFullRoute()()+d.substring(1);for(var i=0;"../"===d.substring(0,3);)i++,d=d.slice(3);var j=c.getFullRoute()(),l=j.slice(0,j.length-i).join("/"),m=(""===l?"":l+"/")+d;return e.useHTML5history?b("base").attr("href")+m:e.Href.hash+m}h=d}var n=h.getFullRoute()().join("/");return e.useHTML5history?b("base").attr("href")+n:e.Href.hash+n},n.path$=function(a){return d(this.path,this)(a)},n.async=function(a,b,c,d){var f=this;return function(){h&&h.reject({cancel:!0});var i=a();h=i,d&&d(i.state());var j=Math.random();g=j,i.done(function(){d&&d(i.state()),j===g&&e.navigate(f.path(b))}),i.fail(function(a){d&&d(i.state());var b=a&&a.cancel;j===g&&!b&&c&&e.navigate(f.path(c))})}},n.showPage=function(a,b,c){var d=this,e=d.currentId,f=d.pageRoute?d.pageRoute.params:null,g=d.isVisible();d.currentId=b?b.name||"":"",d.getCurrentId(d.currentId),d.isVisible(!0),c&&d.originalRoute(c),d.route=a,d.pageRoute=b,g?("?"===d.getId()&&e!==d.currentId&&d.show(),b&&f!==b.params&&d.setParams()):(d.setParams(),d.show()),d.childManager.showChild(a)},n.setParams=function(){if(this.pageRoute&&this.pageRoute.params){var a=this.pageRoute.params,d=this.ctx,e=this.val("params")||{};b.isArray(e)?b.each(e,function(b,e){var f=a[e];d[e]?d[e](f):d[e]=c.observable(f)}):b.each(e,function(b,e){var g,f=a[b];g=null==f?k.value(e):f,d[b]?d[b](g):d[b]=c.observable(g)})}if(this.pageRoute){var f=this.getValue().nameParam;f&&("string"==typeof f?this.ctx[f]?this.ctx[f](this.currentId):this.ctx[f]=c.observable(this.currentId):f(this.currentId))}},n.hidePage=function(a){var b=this;"show"!==b.val("urlToggle")?(b.hideElementWrapper(a),b.childManager.hideChild()):a&&a()};var o=function(a){try{c.applyBindingsToDescendants(a.childBindingContext,a.element)}catch(b){f(a,"onBindingError",{error:b})}};n.init=function(){var a=this,d=a.val("urlToggle"),e=a.val("id");"?"!==e&&a.getCurrentId(e);var g=c.utils.domData.get(a.element,"__ko_pagerjsBindingData");if(g)return{controlsDescendantBindings:!0};c.utils.domData.set(a.element,"__ko_pagerjsBindingData",a),c.utils.domNodeDisposal.addDisposeCallback(a.element,function(){f(a,"beforeRemove"),a.parentPage&&a.parentPage.children.remove(a),f(a,"afterRemove")});var h=a.getValue();if("none"!==d&&(a.parentPage=a.getParentPage(),a.parentPage.children.push(this),a.hideElement()),a.val("source")&&a.loadSource(a.val("source")),a.ctx=null,h.withOnShow)a.ctx={},a.childBindingContext=a.bindingContext.createChildContext(a.ctx),c.utils.extend(a.childBindingContext,{$page:this});else{var i=h["with"]||a.bindingContext.$observableData||a.viewModel;if(a.ctx=k.value(i),a.augmentContext(),c.isObservable(i)){var j=c.observable(a.ctx);a.childBindingContext=a.bindingContext.createChildContext(j),c.utils.extend(a.childBindingContext,{$page:this,$observableData:i}),o(a),i.subscribe(function(){j(k.value(i))})}else a.childBindingContext=a.bindingContext.createChildContext(a.ctx),c.utils.extend(a.childBindingContext,{$page:this,$observableData:void 0}),o(a)}if("none"!==d){var l=a.parentPage;l.route&&(l.route[0]===a.getId()||l.route.length&&"?"===a.getId())&&setTimeout(function(){l.showPage(l.route)},0)}else{var m=function(){b(a.element).is(":visible")&&a.showPage([])};setTimeout(m,0),a.getParentPage().isVisible.subscribe(function(a){a&&setTimeout(m,0)})}var n=a.getValue().bind;return c.isObservable(n)&&n(a),{controlsDescendantBindings:!0}},n.augmentContext=function(){var a=this,d=a.val("params");d&&(b.isArray(d)?b.each(d,function(b,d){a.ctx[d]||(a.ctx[d]=c.observable())}):b.each(d,function(b,e){a.ctx[b]||(c.isObservable(e)?a.ctx[b]=e:null===e?(d[b]=c.observable(null),a.ctx[b]=c.observable(null)):a.ctx[b]=c.observable(e))})),this.val("vars")&&b.each(this.val("vars"),function(b,d){a.ctx[b]=c.isObservable(d)?d:c.observable(d)});var e=this.getValue().nameParam;e&&"string"==typeof e&&(a.ctx[e]=c.observable(null)),this.setParams()},n.getValue=function(){return this.valueAccessor?k.value(this.valueAccessor()):{}},n.getParentPage=function(){return e.getParentPage(this.bindingContext)},n.getId=function(){return this.val("id")},n.id=function(){var a=this.getCurrentId();return null==a||""===a?this.getId():a},n.sourceUrl=function(a){var b=this;return"?"===this.getId()?c.computed(function(){var c;return c=b.val("deep")?[b.currentId].concat(b.route).join("/"):b.currentId,k.value(a).replace("{1}",c)}):c.computed(function(){return k.value(a)})},n.loadWithOnShow=function(){var a=this;a.withOnShowLoaded&&a.val("sourceCache")===!0||(a.withOnShowLoaded=!0,a.val("withOnShow")(function(b){var d=a.bindingContext.createChildContext(b);a.ctx=b,a.childBindingContext=d,a.augmentContext(),c.utils.extend(d,{$page:a}),o(a)},a))},n.loadSource=function(a){var d=this.getValue(),f=this,g=this.element,h=null,i=d.loader||e.loader;if("iframe"===d.frame){var j=b("iframe",b(g));0===j.length&&(j=b("<iframe></iframe>"),b(g).append(j)),i&&(h=k.value(i)(f,j),h.load()),j.one("load",function(){h&&h.unload(),d.sourceLoaded&&d.sourceLoaded(f)}),c.applyBindingsToNode(j[0],{attr:{src:this.sourceUrl(a)}})}else{i&&(h=k.value(i)(f,f.element),h.load());var l=function(){h&&h.unload(),f.val("withOnShow")?f.val("withOnShow")&&f.loadWithOnShow():o(f),d.sourceLoaded&&d.sourceLoaded(f),f.route&&f.childManager.showChild(f.route)};if("string"==typeof k.value(a)){var m=k.value(this.sourceUrl(a));q(g,m,function(){l()},f)}else{var n=b(g).children();k.value(a)(this,function(){b.each(n,function(a,b){c.utils.domNodeDisposal.removeNode(b)}),l()})}}};var p=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,q=function(a,d,e,g){var h,i,j=b(a),k=d.indexOf(" ");k>=0&&(h=d.slice(k,d.length),d=d.slice(0,k));var l=jQuery.ajax({url:d,type:"GET",dataType:"html",complete:function(a,b){e&&j.each(e,i||[a.responseText,b,a])}}).done(function(a){i=arguments,b.each(j.children(),function(a,b){c.utils.domNodeDisposal.removeNode(b)}),j.html(h?jQuery("<div>").append(a.replace(p,"")).find(h):a)});return l.fail(function(){f(g,"onSourceError",{url:d,xhrPromise:l})}),j};n.show=function(b){var c=this.element,d=this;d.showElementWrapper(b),d.val("title")&&(a.document.title=d.val("title")),d.val("sourceOnShow")?(!d.val("sourceCache")||!c.__pagerLoaded__||"number"==typeof d.val("sourceCache")&&c.__pagerLoaded__+1e3*d.val("sourceCache")<e.now())&&(c.__pagerLoaded__=e.now(),d.loadSource(d.val("sourceOnShow"))):d.val("withOnShow")&&d.loadWithOnShow()},n.titleOrId=function(){return this.val("title")||this.id()},n.showElementWrapper=function(a){var b=this;f(b,"beforeShow"),b.showElement(a),b.val("scrollToTop")&&b.element.scrollIntoView(),f(b,"afterShow")},n.showElement=function(a){this.val("showElement")?this.val("showElement")(this,a):this.val("fx")?e.fx[this.val("fx")].showElement(this,a):e.showElement?e.showElement(this,a):b(this.element).show(a)},n.hideElementWrapper=function(a){this.isVisible(!1),f(this,"beforeHide"),this.hideElement(a),f(this,"afterHide")},n.hideElement=function(a){this.val("hideElement")?this.val("hideElement")(this,a):this.val("fx")?e.fx[this.val("fx")].hideElement(this,a):e.hideElement?e.hideElement(this,a):(b(this.element).hide(),a&&a())},n.getFullRoute=function(){return this._fullRoute?this._fullRoute:(this._fullRoute=c.computed(function(){var a=null;return this.currentParentPage&&this.currentParentPage()?(a=this.currentParentPage().getFullRoute()().slice(0),a.push(this.originalRoute()||this.getId()),a):this.parentPage?(a=this.parentPage.getFullRoute()().slice(0),a.push(this.originalRoute()||this.getId()),a):[]},this),this._fullRoute)},n.getRole=function(){return this.val("role")||"next"},n.isStartPage=function(){return"start"===this.getId()||"start"===this.getRole()},n.nullObject=new e.Page,n.nullObject.children=c.observableArray([]),n.child=function(a){var d=this;return null==d._child&&(d._child={}),d._child[a]||(d._child[a]=c.computed(function(){var c=b.grep(this.children(),function(b){return b.id()===a})[0];return c||this.nullObject},this)),d._child[a]},e.getActivePage=function(){for(var a=e.page;null!=a.currentChildPage()();)a=a.currentChildPage()();return a},c.bindingHandlers.page={init:function(a,b,c,d,f){var g=null;return k.value(b())instanceof e.Page?(g=k.value(b()),g.element=a,null==g.allBindingsAccessor&&(g.allBindingsAccessor=c),null==g.viewModel&&(g.viewModel=d),null==g.bindingContext&&(g.bindingContext=f)):g=new e.Page(a,b,c,d,f),g.init()}},e.useHTML5history=!1,e.rootURI="/",e.Href=function(a,b,d,e,f){this.element=a,this.bindingContext=f,this.path=c.observable(),this.pageOrRelativePath=c.observable(b)};var r=e.Href.prototype;return r.getParentPage=function(){return e.getParentPage(this.bindingContext)},r.init=function(){var a=this,b=a.getParentPage();a.path=c.computed(function(){var c=k.value(a.pageOrRelativePath()());return b.path(c)})},e.Href.hash="#",r.bind=function(){c.applyBindingsToNode(this.element,{attr:{href:this.path}})},r.update=function(a){this.pageOrRelativePath(a)},e.Href5=function(){e.Href.apply(this,arguments)},e.Href5.prototype=new e.Href,e.Href5.history=a.History,e.Href5.prototype.bind=function(){var a=this;c.applyBindingsToNode(a.element,{attr:{href:a.path},click:function(){var c=a.path();(""===c||"/"===c)&&(c=b("base").attr("href")),e.Href5.history.pushState(null,null,c)}})},c.bindingHandlers["page-href"]={init:function(a,b,c,d,f){var g=e.useHTML5history?e.Href5:e.Href,h=new g(a,b,c,d,f);h.init(),h.bind(),a.__ko__page=h},update:function(a,b){a.__ko__page.update(b)}},e.fx={},e.fx.cssAsync=function(a){return{showElement:function(c,d){var e=b(c.element);e.addClass(a),e.show();var f=setInterval(function(){clearInterval(f),e.addClass(a+"-in")},10),g=setInterval(function(){clearInterval(g),d&&d()},300)},hideElement:function(c,d){var e=b(c.element);if(c.pageHiddenOnce){e.removeClass(a+"-in");var f=setInterval(function(){clearInterval(f),d&&d(),e.hide()},300)}else c.pageHiddenOnce=!0,e.hide()}}},e.fx.zoom=e.fx.cssAsync("pagerjs-fx-zoom"),e.fx.flip=e.fx.cssAsync("pagerjs-fx-flip"),e.fx.popout=e.fx.cssAsync("pagerjs-fx-popout-modal"),e.fx.jQuerySync=function(a,c){return{showElement:function(c,d){a.call(b(c.element),300,d)},hideElement:function(a,d){c.call(b(a.element),300,function(){b(a.element).hide()}),d&&d()}}},e.fx.slide=e.fx.jQuerySync(b.fn.slideDown,b.fn.slideUp),e.fx.fade=e.fx.jQuerySync(b.fn.fadeIn,b.fn.fadeOut),e.startHistoryJs=function(b){var c="string"==typeof b?b:null;c&&e.Href5.history.pushState(null,null,c),e.Href5.history.Adapter.bind(a,"statechange",function(){var a=e.Href5.history.getState().url.replace(e.Href5.history.getBaseUrl(),"");i(a)}),e.Href5.history.Adapter.bind(a,"anchorchange",function(){i(location.hash)}),b&&b.noGo||i(e.Href5.history.getState().url.replace(e.Href5.history.getBaseUrl(),""))},e.start=function(c){var d="string"==typeof c?c:null;d&&(a.location.hash=e.Href.hash+d);var f=function(){i(a.location.hash)};b(a).bind("hashchange",f),c&&c.noGo||f()},e},c=a.define;"function"==typeof c&&"object"==typeof c.amd&&c.amd?c("pager",["knockout","jquery"],function(a){return b($,a)}):a.pager=b($,ko)}(window);
